name: test-run

trainer:
  model_path: /notebooks/storage/animesfw
  batch_size: 2
  resolution: 512
  center_crop: false
  gradient_checkpointing: true
  clip_skip: 2
  seed: 1138

  use_ema: false
  use_hivemind: false
  use_xformers: false
  lr_scale: sqrt
  train_text_encoder: false
  attention_slicing: false
  vae_slicing: true

  offset_noise: false
  offset_noise_val: 0.1
  min_snr: false
  min_snr_val: 5

checkpoint:
  monitor: 'epoch'
  dirpath: 'checkpoint' # Use S3: 's3://bucketname/whatever'
  filename: 'sample-nd-epoch{epoch:02d}-loss{train_loss:.2f}'
  auto_insert_metric_name: false
  every_n_epochs: 3
  save_top_k: 3
  mode: 'max'
  save_last: false
  save_weights_only: false
  extended:
    save_fp16_weights: true

lightning:
  accelerator: gpu
  devices: -1
  max_epochs: 20
  precision: bf16-true
  log_every_n_steps: 1
  accumulate_grad_batches: 1
  gradient_clip_val: 0.0

#s3:
#  enabled: true
#  args:
#    anon: false
#    key: 'access-key'
#    secret: 'access-secret'
#    endpoint_url: 'endpoint_url'
#    default_block_size: 5242880 # For Cloudflare R2 this need to be >= 50MB

arb:
  enabled: true
  debug: false
  base_res: [512, 512]
  max_size: [768, 512]
  divisible: 64
  max_ar_error: 4
  min_dim: 256
  dim_limit: 1024

dataset:
  img_path: 
    - "/notebooks/rurudo_lion"
  tag_processor: 
    - data.processors.shuffle_prompts
  center_crop: false
  ucg: 0.1
  debug_arb: false
  cache_latents: false
  allow_duplicates: false

optimizer:
  name: bitsandbytes.optim.PagedAdamW8bit
  params:
    lr: 5e-6
    weight_decay: 1e-2
    eps: 1e-8

lr_scheduler:
  name: transformers.get_constant_schedule_with_warmup
  params:
    num_warmup_steps: 50
    last_epoch: -1

monitor:
  wandb_id: ""
  huggingface_repo: ""
  hf_auth_token: ""
  store_checkpoints: true

sampling:
  enabled: false
  use_wandb: true
  every_n_steps: -1
  every_n_epochs: 1
  save_dir: "samples"
  seed: 1139
  height: 512
  width: 512
  steps: 20
  cfg_scale: 9
  negative_prompts:
    - "lowres, bad anatomy, text, error, extra digit, cropped"
    - "lowres, low quality"
  prompts:
    - "a girl running fast on the country lane"
    - "a girl in black serafuku standing in a field. Tags: solo, food, fruit, lemon, masterpiece"

